<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
<title>Dashboard</title>
<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
<script type="text/javascript" src="http://static.stackmob.com/js/stackmob-js-0.8.0-bundled-min.js"></script>

<script type="text/javascript">
      /* <![CDATA[ */
      // Initialize StackMob object
      // Copy your init data from here: https://dashboard.stackmob.com/sdks/js/config
      // Your other app information is here: https://dashboard.stackmob.com/settings
      StackMob.init({
        appName: 'my_first_app',
        clientSubdomain: 'divyanshimixorgcom',
        publicKey: '6dba825e-b26f-4626-b007-7b09d60ad718',
        apiVersion : 0,
		userSchema: 'organization',
	    loginField: 'organization_id',
	    passwordField: 'password',
      });
      /* ]]> */
</script> 

<script type="text/javascript">
$(document).ready(function() {
	var User = StackMob.Model.extend({ schemaName: 'organization' });		
	var user = new StackMob.User({ organization_id: localStorage.getItem("stackmob.oauth2.user") });
	user.isLoggedIn({
	  yes: function(){
		//console.log("Logged in.");
		//alert("logged in");
	  },
	  no: function(){
		//console.log("Not logged in.");
		window.location = "login.html";
		//alert("not logged in");
	  }
	});
	 
 }); 
 </script>
	
<script type="text/javascript">
      /* <![CDATA[ */
     $(document).ready(function() {
	  		result();
			function result() {
						
	  		var Device_schema = StackMob.Model.extend({ schemaName: 'imagesearch' });
			var device = new Device_schema({ });
					var q = new StackMob.Collection.Query();
					q.orderDesc('lastmoddate');
					device.query(q, {
						success: function(modal) {
							//After StackMob returns "Bill Watterson", print out the result
						   	var array = modal.toJSON();
							 // console.debug(array);
							 //$('#data').html(array[0].user_name);
							 var val = array[0].lastmoddate;
							 $('#last_mod_date').attr('value', val);
							 
								var key;
								var count = 0;
								for(key in array) {
									 if(array.hasOwnProperty(key)) {
									  count ++;
									 }
								 }
								 //alert(count);
							for(var i=0; i<=count; i++)
							{
								if(array[i].org_img == localStorage.getItem("stackmob.oauth2.user"))
								{
									//$('#last_mod_date').html(array[0].lastmoddate);
									var val = array[i].latitude+","+array[i].longitude;
									$('#latlng').attr('value', val);
									//alert(val);
									$(".device_id").append(array[i].dev_img +"<br/>");												 
									$(".image_id").append(array[i].imageid +"<br/>");
									//$(".location").append(array[i].latitude +","+ array[i].longitude +"<br/>");
									$(".feedback").append(array[i].feedback +"<br/>");
									$(".mobile_no").append(array[i].mobile_no +"<br/>");
									$(".lastmoddate").append(array[i].lastmoddate +"<br/>");
									$(".location").append(val +"<br/>");
									$(".model").append(array[i].model +"<br/>");
								} //end if condition
							} // end for loop
						} //end success
				 	 }); // end imagesearch schema query
					 } // end result function
					 
			setInterval(check_newentry,1000);
					 
					 function check_newentry() {
					 	var Device_schema = StackMob.Model.extend({ schemaName: 'imagesearch' });
			var device = new Device_schema({  });
					var q = new StackMob.Collection.Query();
					q.orderDesc('lastmoddate');
					device.query(q, {
						success: function(modal) {
							//After StackMob returns "Bill Watterson", print out the result
						   	var array = modal.toJSON();
							 // console.debug(array);
							 //$('#data').html(array[0].user_name);
							 
							 var lastmod_date = array[0].lastmoddate;
							 var lastmod_date_old = document.getElementById("last_mod_date").getAttribute("value");
							 //alert(lastmod_date_old +"..."+ lastmod_date);
							 if(lastmod_date_old < lastmod_date)
							{
								alert("data updated");
								$(".device_id").html("");
							 	 $(".image_id").html("");
								 $(".feedback").html("");
								 $(".mobile_no").html("");
								$(".location").html("");
								$(".lastmoddate").html(""); 
								$(".model").html(""); 
								
								var val = array[0].lastmoddate;
								 $('#last_mod_date').attr('value', val);
								
								var key;
								var count = 0;
								for(key in array) {
									 if(array.hasOwnProperty(key)) {
									  count ++;
									 }
								 }
								 //alert(count);
						 for(var i=0; i<=count; i++)
							{
								if(array[i].org_img == localStorage.getItem("stackmob.oauth2.user"))
								{
									var val = array[i].latitude+","+array[i].longitude;
									$('#latlng').attr('value', val);
									
									$(".device_id").append(array[i].dev_img +"<br/>");									 
									$(".image_id").append(array[i].imageid +"<br/>");
									//$(".location").append(array[i].latitude +","+ array[i].longitude +"<br/>");
									$(".feedback").append(array[i].feedback +"<br/>");
									$(".mobile_no").append(array[i].mobile_no +"<br/>");
									$(".lastmoddate").append(array[i].lastmoddate +"<br/>");
									$(".location").append(val +"<br/>");
									$(".model").append(array[i].model +"<br/>");
								}
							}
						}
						}
				 	 });
					 } // end check_newentry function 
				});
					 
		</script>
</head>

<body>
<table border="2">
	<tr>
		<th>Device-id</th>
		<th>Image-id</th>
		<th>Feedback</th>
		<th>Mobile-no</th>
		<th>Model</th>
		<th>Location</th>
		<th>Time</th>
	</tr>
	<tr>
		<td class="device_id"></td>
		<td class="image_id"></td>
		<td class="feedback"></td>
		<td class="mobile_no"></td>
		<td class="model"></td>
		<td class="location"></td>
		<td class="lastmoddate"></td>
	</tr>
</table>
<div id="last_mod_date" value=""></div>
<div id="latlng" value=""></div> 
</body>
</html>
